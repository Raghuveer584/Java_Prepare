<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_1496pfr" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="1.16.0">
  <bpmn:process id="tolladjustment" name="tolladjustment" isExecutable="true">
    <bpmn:startEvent id="StartEvent_1pjx04s" name="Receve Toll Adjustment&#10;&#10;">
      <bpmn:outgoing>SequenceFlow_0rkofm2</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="SequenceFlow_0rkofm2" sourceRef="StartEvent_1pjx04s" targetRef="Task_12zft5g" />
    <bpmn:exclusiveGateway id="ExclusiveGateway_0wu4o8m" name="Approved?">
      <bpmn:incoming>SequenceFlow_00ayqkw</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_00z9wep</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_1lwgoi8</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:endEvent id="EndEvent_08qgswl">
      <bpmn:incoming>SequenceFlow_1sf7x4n</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="SequenceFlow_00z9wep" name="Good to automatic approval" sourceRef="ExclusiveGateway_0wu4o8m" targetRef="Task_0mpcqhv">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${dmnResult=='Approved'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_1lwgoi8" name="Need for manual review" sourceRef="ExclusiveGateway_0wu4o8m" targetRef="UserTask_0yu0wl8">
      <bpmn:documentation>Pending Approval</bpmn:documentation>
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${dmnResult=='Pending Approval'}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_00ayqkw" sourceRef="Task_12zft5g" targetRef="ExclusiveGateway_0wu4o8m" />
    <bpmn:businessRuleTask id="Task_12zft5g" name="Adjustment Decisions" camunda:resultVariable="dmnResult" camunda:decisionRef="adjustments" camunda:mapDecisionResult="singleEntry">
      <bpmn:incoming>SequenceFlow_0rkofm2</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_00ayqkw</bpmn:outgoing>
    </bpmn:businessRuleTask>
    <bpmn:userTask id="UserTask_0yu0wl8" name="Toll Adjustment Approve" camunda:candidateGroups="rhCSR_Supervisor">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="approval" label="Do you approve this request?" type="boolean" defaultValue="false" />
        </camunda:formData>
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_1lwgoi8</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1m73v81</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="SequenceFlow_1m73v81" sourceRef="UserTask_0yu0wl8" targetRef="ExclusiveGateway_1abjbll" />
    <bpmn:exclusiveGateway id="ExclusiveGateway_1abjbll">
      <bpmn:incoming>SequenceFlow_17dpb79</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_1m73v81</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_09qkk7f</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_0l2k44u</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:endEvent id="EndEvent_08h2xpa">
      <bpmn:incoming>SequenceFlow_09qkk7f</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="SequenceFlow_09qkk7f" name="Too much money for adjustment toll" sourceRef="ExclusiveGateway_1abjbll" targetRef="EndEvent_08h2xpa">
      <bpmn:documentation>No Approval Too much money for adjustment</bpmn:documentation>
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approval==false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:serviceTask id="Task_0mpcqhv" name="Process Toll Adjustment in Rite 2.0">
      <bpmn:extensionElements>
        <camunda:connector>
          <camunda:inputOutput>
            <camunda:inputParameter name="url">
              <camunda:script scriptFormat="JavaScript">var mendixUrl = execution.getVariable('mendixUrl'); mendixUrl + '/camunda/v1/tolladjustment';</camunda:script>
            </camunda:inputParameter>
            <camunda:inputParameter name="method">POST</camunda:inputParameter>
            <camunda:inputParameter name="headers">
              <camunda:map>
                <camunda:entry key="Accept">application/json</camunda:entry>
                <camunda:entry key="content-type">application/json</camunda:entry>
              </camunda:map>
            </camunda:inputParameter>
            <camunda:inputParameter name="payload">
              <camunda:script scriptFormat="JavaScript">var accountId=execution.getVariable("accountId");
var shiftId=execution.getVariable("shiftId");
var locationInfoId=execution.getVariable("locationInfoId");
var username=execution.getVariable("username");
var adjustmentAmt=execution.getVariable("amount");
var comment=execution.getVariable("comment");
var tollAdjustmentType=execution.getVariable("adjType");
var transactionIds=execution.getVariable("transactionIds");
var vehicleClassId=execution.getVariable("vId");

var result = '{'
   +'"accountId":"'+accountId+ '",'
   +'"shiftId":"'+shiftId+ '",'
   +'"locationInfoId":"'+locationInfoId+ '",'
   +'"username":"'+username+ '",'
   +'"adjustmentAmt":'+adjustmentAmt+ ','
   +'"comment":"'+comment+ '",'
   +'"tollAdjustmentType":"'+tollAdjustmentType+ '",'
   +'"transactionIds":"'+transactionIds+ '",'
   +'"vehicleClassId":"'+vehicleClassId+ '"'
+'}';

'' + result;</camunda:script>
            </camunda:inputParameter>
            <camunda:outputParameter name="WsResponse">
              <camunda:script scriptFormat="JavaScript">S(response).prop('status').numberValue();</camunda:script>
            </camunda:outputParameter>
          </camunda:inputOutput>
          <camunda:connectorId>http-connector</camunda:connectorId>
        </camunda:connector>
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_00z9wep</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_0l2k44u</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_03mcybb</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="SequenceFlow_0l2k44u" name="OK to adjust toll" sourceRef="ExclusiveGateway_1abjbll" targetRef="Task_0mpcqhv">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approval==true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_03mcybb" sourceRef="Task_0mpcqhv" targetRef="ScriptTask_1qfbt1y" />
    <bpmn:scriptTask id="ScriptTask_1qfbt1y" name="Script Task" scriptFormat="JavaScript">
      <bpmn:incoming>SequenceFlow_03mcybb</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1q6vyfn</bpmn:outgoing>
      <bpmn:script>var system = java.lang.System;
var wsresponse = execution.getVariable("WsResponse");
system.out.println('WsService Response' + WsResponse);</bpmn:script>
    </bpmn:scriptTask>
    <bpmn:sequenceFlow id="SequenceFlow_1q6vyfn" sourceRef="ScriptTask_1qfbt1y" targetRef="ExclusiveGateway_0e3hoh2" />
    <bpmn:exclusiveGateway id="ExclusiveGateway_0e3hoh2">
      <bpmn:incoming>SequenceFlow_1q6vyfn</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1sf7x4n</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_07lf2h1</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="SequenceFlow_1sf7x4n" sourceRef="ExclusiveGateway_0e3hoh2" targetRef="EndEvent_08qgswl">
      <bpmn:documentation>Good to end process</bpmn:documentation>
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${WsResponse== 200}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:userTask id="UserTask_15ifnf9" name="Check why Toll Adjustment Failed" camunda:candidateGroups="rhCSR_Supervisor,rhAdministrator">
      <bpmn:documentation>Check why Accoun Creation Failed Or need to send again</bpmn:documentation>
      <bpmn:incoming>SequenceFlow_07lf2h1</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_17dpb79</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="SequenceFlow_07lf2h1" sourceRef="ExclusiveGateway_0e3hoh2" targetRef="UserTask_15ifnf9">
      <bpmn:documentation>Process Toll in Rite 2.0 failed</bpmn:documentation>
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${WsResponse!= 200}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_17dpb79" sourceRef="UserTask_15ifnf9" targetRef="ExclusiveGateway_1abjbll" />
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="tolladjustment">
      <bpmndi:BPMNShape id="StartEvent_1pjx04s_di" bpmnElement="StartEvent_1pjx04s">
        <dc:Bounds x="156" y="365" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="147" y="408" width="58" height="53" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0rkofm2_di" bpmnElement="SequenceFlow_0rkofm2">
        <di:waypoint x="192" y="383" />
        <di:waypoint x="288" y="383" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ExclusiveGateway_0wu4o8m_di" bpmnElement="ExclusiveGateway_0wu4o8m" isMarkerVisible="true">
        <dc:Bounds x="552" y="358" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="551" y="334" width="53" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_08qgswl_di" bpmnElement="EndEvent_08qgswl">
        <dc:Bounds x="1489" y="365" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_00z9wep_di" bpmnElement="SequenceFlow_00z9wep">
        <di:waypoint x="602" y="383" />
        <di:waypoint x="1089" y="383" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="822" y="341" width="49" height="40" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1lwgoi8_di" bpmnElement="SequenceFlow_1lwgoi8">
        <di:waypoint x="577" y="408" />
        <di:waypoint x="577" y="557" />
        <di:waypoint x="650" y="557" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="591" y="473" width="82" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_00ayqkw_di" bpmnElement="SequenceFlow_00ayqkw">
        <di:waypoint x="388" y="383" />
        <di:waypoint x="552" y="383" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="BusinessRuleTask_1shrg2w_di" bpmnElement="Task_12zft5g">
        <dc:Bounds x="288" y="343" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="UserTask_0yu0wl8_di" bpmnElement="UserTask_0yu0wl8">
        <dc:Bounds x="650" y="517" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1m73v81_di" bpmnElement="SequenceFlow_1m73v81">
        <di:waypoint x="750" y="557" />
        <di:waypoint x="967" y="557" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="817" y="515" width="55" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ExclusiveGateway_1abjbll_di" bpmnElement="ExclusiveGateway_1abjbll" isMarkerVisible="true">
        <dc:Bounds x="967" y="532" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_08h2xpa_di" bpmnElement="EndEvent_08h2xpa">
        <dc:Bounds x="1489" y="649" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_09qkk7f_di" bpmnElement="SequenceFlow_09qkk7f">
        <di:waypoint x="992" y="582" />
        <di:waypoint x="992" y="667" />
        <di:waypoint x="1489" y="667" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="965" y="622" width="85" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ServiceTask_1q4z9ii_di" bpmnElement="Task_0mpcqhv">
        <dc:Bounds x="1089" y="343" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0l2k44u_di" bpmnElement="SequenceFlow_0l2k44u">
        <di:waypoint x="1017" y="557" />
        <di:waypoint x="1139" y="557" />
        <di:waypoint x="1139" y="423" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1091" y="483" width="75" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_03mcybb_di" bpmnElement="SequenceFlow_03mcybb">
        <di:waypoint x="1189" y="383" />
        <di:waypoint x="1258" y="383" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ScriptTask_1qfbt1y_di" bpmnElement="ScriptTask_1qfbt1y">
        <dc:Bounds x="1258" y="343" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1q6vyfn_di" bpmnElement="SequenceFlow_1q6vyfn">
        <di:waypoint x="1358" y="383" />
        <di:waypoint x="1408" y="383" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ExclusiveGateway_0e3hoh2_di" bpmnElement="ExclusiveGateway_0e3hoh2" isMarkerVisible="true">
        <dc:Bounds x="1408" y="358" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1sf7x4n_di" bpmnElement="SequenceFlow_1sf7x4n">
        <di:waypoint x="1433" y="383" />
        <di:waypoint x="1489" y="383" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="UserTask_15ifnf9_di" bpmnElement="UserTask_15ifnf9">
        <dc:Bounds x="942" y="176" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_07lf2h1_di" bpmnElement="SequenceFlow_07lf2h1">
        <di:waypoint x="1433" y="358" />
        <di:waypoint x="1433" y="216" />
        <di:waypoint x="1042" y="216" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_17dpb79_di" bpmnElement="SequenceFlow_17dpb79">
        <di:waypoint x="992" y="256" />
        <di:waypoint x="992" y="532" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
