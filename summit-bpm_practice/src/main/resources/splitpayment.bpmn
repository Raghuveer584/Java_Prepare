<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_0ry6ewo" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="1.16.0">
  <bpmn:process id="SplitPayment" name="SplitPayment" isExecutable="true">
    <bpmn:startEvent id="SplitPayment_1" name="SplitPayment">
      <bpmn:outgoing>SequenceFlow_1psvlbh</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:businessRuleTask id="BusinessRuleTask_1a7q612" name="Split Payment Decisions" camunda:resultVariable="approval" camunda:decisionRef="SplitPayments" camunda:mapDecisionResult="singleEntry">
      <bpmn:incoming>SequenceFlow_1psvlbh</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1lu4hir</bpmn:outgoing>
    </bpmn:businessRuleTask>
    <bpmn:sequenceFlow id="SequenceFlow_1psvlbh" name="SplitPayment" sourceRef="SplitPayment_1" targetRef="BusinessRuleTask_1a7q612">
      <bpmn:documentation>SplitPayment</bpmn:documentation>
    </bpmn:sequenceFlow>
    <bpmn:endEvent id="EndEvent_0a36a7k">
      <bpmn:incoming>SequenceFlow_0b4k9ku</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="SequenceFlow_1lu4hir" sourceRef="BusinessRuleTask_1a7q612" targetRef="ExclusiveGateway_0yf39es" />
    <bpmn:exclusiveGateway id="ExclusiveGateway_0yf39es">
      <bpmn:incoming>SequenceFlow_1lu4hir</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1kvx39f</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_0bag17f</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="SequenceFlow_1kvx39f" name="Approval Split payment request" sourceRef="ExclusiveGateway_0yf39es" targetRef="ServiceTask_0agf5ra">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approval==true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:userTask id="Task_16kjiyg" name="Review Split Payment Queue" camunda:candidateGroups="rhAdministrator,rhAsst_Director,rhCSC_Manager,rhCSC_Asst_Manager,rhFin_Manager">
      <bpmn:incoming>SequenceFlow_1kwg67h</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0ru0uoe</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="SequenceFlow_0bag17f" name="Send to Reviewer" sourceRef="ExclusiveGateway_0yf39es" targetRef="UserTask_0v7i7g5">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approval==false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_0ru0uoe" sourceRef="Task_16kjiyg" targetRef="ExclusiveGateway_0x8o1pb" />
    <bpmn:exclusiveGateway id="ExclusiveGateway_0x8o1pb">
      <bpmn:incoming>SequenceFlow_0ru0uoe</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_100zz9p</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_14mqtgq</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:serviceTask id="ServiceTask_0agf5ra" name="Process Split Payment">
      <bpmn:extensionElements>
        <camunda:connector>
          <camunda:inputOutput>
            <camunda:inputParameter name="url">
              <camunda:script scriptFormat="JavaScript">var adapterUrl = execution.getVariable('adapterUrl'); 
adapterUrl + '/unsecure/payment/processSplitPayment';</camunda:script>
            </camunda:inputParameter>
            <camunda:inputParameter name="method">POST</camunda:inputParameter>
            <camunda:inputParameter name="headers">
              <camunda:map>
                <camunda:entry key="Accept">application/json</camunda:entry>
                <camunda:entry key="content-type">application/json</camunda:entry>
              </camunda:map>
            </camunda:inputParameter>
            <camunda:inputParameter name="payload">
              <camunda:script scriptFormat="JavaScript">var paymentId=execution.getVariable("paymentId");
var accountId=execution.getVariable("accountId");
var splitPaymentDetails=execution.getVariable("splitDetails");
var userName=execution.getVariable("userName");
var locationId=execution.getVariable("locationInfoId");
var shiftId=execution.getVariable("shiftId");
var comment=execution.getVariable("comment"); 
'{'
   +'"accountId":"'+accountId+ '",'
   +'"paymentId":"'+paymentId+ '",'   
   +'"comments":"'+comment+ '",'
   +'"splitDetails":'+splitPaymentDetails+ ','
   +'"userDTO": {'
   +'"username":"'+userName+ '",'
   +'"locationId":'+locationId +','
   +'"shiftId":'+shiftId             
    +'}'
+'}';</camunda:script>
            </camunda:inputParameter>
          </camunda:inputOutput>
          <camunda:connectorId>http-connector</camunda:connectorId>
        </camunda:connector>
        <camunda:properties>
          <camunda:property name="url" value="https://etcc-test.mendixcloud.com/rest" />
        </camunda:properties>
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_1kvx39f</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_14mqtgq</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_0b4k9ku</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="SequenceFlow_0b4k9ku" sourceRef="ServiceTask_0agf5ra" targetRef="EndEvent_0a36a7k" />
    <bpmn:endEvent id="EndEvent_06x8kwb">
      <bpmn:incoming>SequenceFlow_100zz9p</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="SequenceFlow_100zz9p" name="Reject the Split Payment Request" sourceRef="ExclusiveGateway_0x8o1pb" targetRef="EndEvent_06x8kwb">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approval==false}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_14mqtgq" sourceRef="ExclusiveGateway_0x8o1pb" targetRef="ServiceTask_0agf5ra">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${approval==true}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:userTask id="UserTask_0v7i7g5" name="Ready For Assignment Queue" camunda:candidateGroups="rhAdministrator,rhAsst_Director,rhCSC_Manager,rhCSC_Asst_Manager,rhFin_Manager">
      <bpmn:documentation>Ready For Assignment Queue</bpmn:documentation>
      <bpmn:incoming>SequenceFlow_0bag17f</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1kwg67h</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="SequenceFlow_1kwg67h" sourceRef="UserTask_0v7i7g5" targetRef="Task_16kjiyg" />
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="SplitPayment">
      <bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="SplitPayment_1">
        <dc:Bounds x="156" y="245" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="141" y="288" width="66" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BusinessRuleTask_1a7q612_di" bpmnElement="BusinessRuleTask_1a7q612">
        <dc:Bounds x="310" y="223" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1psvlbh_di" bpmnElement="SequenceFlow_1psvlbh">
        <di:waypoint x="192" y="263" />
        <di:waypoint x="310" y="263" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="219" y="245" width="66" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="EndEvent_0a36a7k_di" bpmnElement="EndEvent_0a36a7k">
        <dc:Bounds x="1091" y="245" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1lu4hir_di" bpmnElement="SequenceFlow_1lu4hir">
        <di:waypoint x="410" y="263" />
        <di:waypoint x="453" y="263" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ExclusiveGateway_0yf39es_di" bpmnElement="ExclusiveGateway_0yf39es" isMarkerVisible="true">
        <dc:Bounds x="453" y="238" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1kvx39f_di" bpmnElement="SequenceFlow_1kvx39f">
        <di:waypoint x="503" y="263" />
        <di:waypoint x="739" y="263" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="593" y="215" width="83" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="UserTask_1tgg4ys_di" bpmnElement="Task_16kjiyg">
        <dc:Bounds x="428" y="449" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0bag17f_di" bpmnElement="SequenceFlow_0bag17f">
        <di:waypoint x="478" y="288" />
        <di:waypoint x="478" y="340" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="363" y="307" width="89" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0ru0uoe_di" bpmnElement="SequenceFlow_0ru0uoe">
        <di:waypoint x="528" y="489" />
        <di:waypoint x="561" y="489" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="ExclusiveGateway_0x8o1pb_di" bpmnElement="ExclusiveGateway_0x8o1pb" isMarkerVisible="true">
        <dc:Bounds x="561" y="464" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ServiceTask_0agf5ra_di" bpmnElement="ServiceTask_0agf5ra">
        <dc:Bounds x="739" y="223" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_0b4k9ku_di" bpmnElement="SequenceFlow_0b4k9ku">
        <di:waypoint x="839" y="263" />
        <di:waypoint x="1091" y="263" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="EndEvent_06x8kwb_di" bpmnElement="EndEvent_06x8kwb">
        <dc:Bounds x="1091" y="471" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_100zz9p_di" bpmnElement="SequenceFlow_100zz9p">
        <di:waypoint x="611" y="489" />
        <di:waypoint x="1091" y="489" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="780" y="506" width="89" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_14mqtgq_di" bpmnElement="SequenceFlow_14mqtgq">
        <di:waypoint x="586" y="464" />
        <di:waypoint x="586" y="263" />
        <di:waypoint x="739" y="263" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="UserTask_0v7i7g5_di" bpmnElement="UserTask_0v7i7g5">
        <dc:Bounds x="428" y="340" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1kwg67h_di" bpmnElement="SequenceFlow_1kwg67h">
        <di:waypoint x="478" y="420" />
        <di:waypoint x="478" y="449" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
